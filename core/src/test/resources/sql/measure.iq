# measure.iq - measure expressions
#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to you under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
!set outputformat mysql
!use scott

# Measure that references another measure
select *
from (
  select deptno,
    empno + 1 as measure e1,
    e1 + deptno as measure e2
  from "scott".emp
  where job = 'CLERK');
+--------+------+------+
| DEPTNO | E1   | E2   |
+--------+------+------+
|     20 | 7370 | 7390 |
|     20 | 7877 | 7897 |
|     30 | 7901 | 7931 |
|     10 | 7935 | 7945 |
+--------+------+------+
(4 rows)

!ok

# Measure may reference non-measure alias
select deptno + 1 as d1,
  d1 + 2 as measure d3
from "scott".dept;
+----+----+
| D1 | D3 |
+----+----+
| 11 | 13 |
| 21 | 23 |
| 31 | 33 |
| 41 | 43 |
+----+----+
(4 rows)

!ok

# In a measure ('d'), qualified references give you the column, and unqualified
# references give the alias. In a regular select item ('d2'), qualified and
# unqualified references give the column.
select e.empno + 1 as deptno,
 deptno + e.deptno as measure d,
 deptno + e.deptno as d2
from "scott".emp as e
where job = 'CLERK';
+--------+------+----+
| DEPTNO | D    | D2 |
+--------+------+----+
|   7370 | 7390 | 40 |
|   7877 | 7897 | 40 |
|   7901 | 7931 | 60 |
|   7935 | 7945 | 20 |
+--------+------+----+
(4 rows)

!ok

# Aggregate measure
!if (false) {
select deptno, count_plus_100
from (
  select empno, deptno, job, count(*) + 100 as measure count_plus_100
  from "scott".emp)
group by deptno;
!ok
!}

# End measure.iq
